<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard LoRa (Protótipo)</title>

    <style>
      body {
        font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;
        margin: 24px
      }
      h1 {
        margin: 0 0 8px 0
      }
      .card {
        border: 1px solid #ddd;
        border-radius: 12px;
        padding: 16px;
        margin: 12px 0;
        box-shadow: 0 2px 6px rgba(0,0,0,.06);
        transition: background-color 0.2s ease;
      }
      .card:hover { background:#f7f7f7; cursor:pointer }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
        gap: 12px
      }
      table {
        border-collapse: collapse;
        width: 100%
      }
      th, td {
        border-bottom: 1px solid #eee;
        padding: 8px;
        text-align: left;
        font-size: 14px
      }
      small { color:#666 }
      .controls {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-bottom: 8px;
        flex-wrap: wrap
      }
      input, select, button {
        padding: 8px;
        border: 1px solid #ccc;
        background-color: #f0f0f0;
        border-radius: 8px;
        transition: background-color 0.2s ease;
      }
      button:hover, select:hover, input:hover {
        background-color: #dddddd;
        cursor: pointer;
      }
      .table-wrap {
        max-height: 420px;
        overflow: auto;
        border: 1px solid #eee;
        border-radius: 8px
      }
      thead th {
        position: sticky;
        top: 0;
        background: #fafafa
      }
      .badge {
        display: inline-block;
        padding: 2px 6px;
        border: 1px solid #e0e0e0;
        border-radius: 999px;
        background: #fafafa;
        margin-left: 6px;
        font-size: 12px
      }
    </style>
  </head>

  <body>
    <h1>Dashboard de Monitoramento</h1>

    <div class="card">
      <h3>Como executar o simulador</h3>
      <!-- TODO -->
    </div>

    <div class="card">
      <div class="controls">
        <label>Dispositivo:</label>
        <select id="deviceSelect"></select>

        <label>Métrica:</label>
        <select id="metricSelect">
          <option value="temp">Temperatura (°C)</option>
          <option value="hum">Umidade (%)</option>
          <option value="dust">Poeira (µg/m³)</option>
        </select>

        <button id="btnSeries">Carregar Série</button>

        <span id="seriesInfo" class="badge"></span>
      </div>
    </div>

    <div class="card">
      <h3>Últimas leituras por dispositivo</h3>

      <div class="controls">
        <label>Sala:</label>
        <input id="room" placeholder="vazio = todas">
        <button id="btnLatest">Atualizar</button>
        <span id="latestInfo" class="badge"></span>
      </div>
      <div id="latest"></div>
    </div>

    <div class="card">
      <h3>Histórico de leituras</h3>

      <div class="controls">
        <label>Dispositivo:</label>
        <select id="histDevice"></select>

        <label>Registros:</label>
        <input id="histN" type="number" value="50" min="1" max="1000" style="width:100px">

        <button id="btnHist">Carregar Histórico</button>

        <span id="histInfo" class="badge"></span>
      </div>

      <div class="table-wrap">
        <table id="histTable">
          <thead>
            <tr>
              <th>Data/Hora</th>
              <th>Dispositivo</th>
              <th>Sala</th>
              <th>Temperatura (°C)</th>
              <th>Umidade (%)</th>
              <th>Poeira (µg/m³)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script>
      // dados simulados
      function gerarDadosFalsos(n=10, device="sensor-001", room="sala-01"){
        const base = Date.now()/1000
        const arr = []
        for(let i=0;i<n;i++){
          arr.push({
            device_id: device,
            room: room,
            ts: base - i*60,
            temp: (20+Math.random()*8).toFixed(2),
            hum: (40+Math.random()*20).toFixed(2),
            dust: (10+Math.random()*40).toFixed(2)
          })
        }
        return arr
      }

      function preencherSelects(){
        const devices = ["sensor-001","sensor-002","sensor-003"]
        const sel1 = document.getElementById("deviceSelect")
        const sel2 = document.getElementById("histDevice")
        devices.forEach(d=>{
          const opt1=document.createElement("option")
          opt1.value=d; opt1.textContent=d
          const opt2=opt1.cloneNode(true)
          sel1.appendChild(opt1)
          sel2.appendChild(opt2)
        })
      }

      function loadSeries(){
        const id=document.getElementById("deviceSelect").value
        const metric=document.getElementById("metricSelect").value
        const fake=gerarDadosFalsos(20,id)
        document.getElementById("seriesInfo").textContent=`${id} - ${metric} - ${fake.length} pts (simulado)`
      }

      function loadLatest(){
        const data=[
          {device_id:"sensor-001",room:"sala-01",ts:Date.now()/1000,temp:25.2,hum:50.3,dust:20.1},
          {device_id:"sensor-002",room:"sala-02",ts:Date.now()/1000,temp:26.7,hum:48.9,dust:22.8}
        ]
        const el=document.getElementById("latest")
        let html="<div class='grid'>"
        for(const row of data){
          html+=`<div class='card'><b>${row.device_id}</b><br><small>${row.room} • ${new Date(row.ts*1000).toLocaleString()}</small>
            <table>
              <tr><th>Temperatura (°C)</th><td>${row.temp}</td></tr>
              <tr><th>Umidade (%)</th><td>${row.hum}</td></tr>
              <tr><th>Poeira (µg/m³)</th><td>${row.dust}</td></tr>
            </table>
          </div>`
        }
        html+="</div>"
        el.innerHTML=html
        document.getElementById("latestInfo").textContent="Simulação local"
      }

      function loadHistory(){
        const id=document.getElementById("histDevice").value
        const n=parseInt(document.getElementById("histN").value)
        const data=gerarDadosFalsos(n,id)
        const tbody=document.querySelector("#histTable tbody")
        tbody.innerHTML=""
        data.forEach(d=>{
          const tr=document.createElement("tr")
          tr.innerHTML=`<td>${new Date(d.ts*1000).toLocaleString()}</td>
                        <td>${d.device_id}</td>
                        <td>${d.room}</td>
                        <td>${d.temp}</td>
                        <td>${d.hum}</td>
                        <td>${d.dust}</td>`
          tbody.appendChild(tr)
        })
        document.getElementById("histInfo").textContent=`${id} - ${n} registros (simulados)`
      }

      document.getElementById("btnSeries").addEventListener("click",loadSeries)
      document.getElementById("btnLatest").addEventListener("click",loadLatest)
      document.getElementById("btnHist").addEventListener("click",loadHistory)

      function boot(){
        preencherSelects()
        loadSeries()
        loadLatest()
        loadHistory()
      }
      boot()
    </script>

  </body>
</html>
